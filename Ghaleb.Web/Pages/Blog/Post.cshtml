@page "{id}/{url?}"
@using Microsoft.AspNetCore.Http.Extensions;
@model Ghaleb.Web.Pages.Mag.PostModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
    ViewData["Seo"] = new
    {
        PageTitle = Model.Blog.Title,
        MetaKeyword = Model.Blog.MetaKeyword,
        MetaDescription = Model.Blog.MetaDescription,
        DoIndex = true
    };
}

@section Tags
    {
    <link rel="canonical" href="@Configuration["SiteSetting:Url"]blog/post/@Model.Blog.Id/@Model.Blog.Url">
}
<div class="col-12 p-3">
    <div class="row">
    </div>
    <div class="row ">
        <div class="col-12 col-lg-3">
        </div>
        <div class="col-12 col-lg-6 bg-white p-3 rounded shadow">
            <div class="row p-4">
                <div class="col-12 d-flex justify-content-center align-items-start flex-column" style="font-size:15px">
                    <div class="breadcramps"><a href="@Url.Page("index")">خانه </a> > <a href="@HttpContext.Request.GetDisplayUrl()"> @Model.Blog.PageTitle</a></div>
                </div>
            </div>
            <div class="row">
                <h1 class="h4 text-right d-block" style="color:#6b7074">@Model.Blog.Title</h1>
            </div>
            <div class="row">
                <div class="col-6">
                    نویسنده : مدیر سایت
                </div>
                <div class="col-6">
                    در تاریخ @Model.Blog.CreatedDate.ConvertToPesainDate()
                </div>
            </div>
            <div class="row">
                <img src="@Model.Blog.Image.BindImage(Configuration)" class="img-fluid mx-auto" />
            </div>
            <div class="row ">
                <div class="col-10 mx-auto rounded p-4 bg-light">
                    @Model.Blog.Abstract
                </div>

            </div>
            <div class="row p-4 mt-5">
                @Html.Raw(Model.Blog.Description)
            </div>

            <div class="row">
                <div class="col-12 col-lg-3">
                    <div class="row mt-3">
                        <span class="col-12">شما هم درباره این پست دیدگاه ثبت کنید</span>
                        <button type="button" class="btn btn-outline-danger col-6 mt-1" data-bs-toggle="modal" data-bs-target="#exampleModal">ثبت نظر</button>
                    </div>
                </div>
                <div class="col-12 col-lg-7">
                    @if (Model.Blog.BlogComments.Any(h => h.IsActive))
                    {
                        foreach (var item in Model.Blog.BlogComments.Where(x => x.IsActive))
                        {
                            <div class="col-12  border-bottom">
                                <div style="border-bottom:1px solid #f5f5f5;" class="p-3 mb-3">
                                    <h1 class="h5">@item.User.Profile.FirstName @item.User.Profile.LastName </h1>
                                    <span style="font-size: 10px;
                        color: #a3a3a3;">@item.CreatedDate.RelativeDate()</span>

                                </div>
                                <p style="font-size: 15px;">@item.Body</p>

                            </div>
                        }
                    }
                    else
                    {
                        <h6>تاکنون نظری برای ‍پست @Model.Blog.Title ثبت نشده</h6>
                    }
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-3">

        </div>

    </div>
</div>

        }
@section Modal{
    <div class="modal  fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">ثبت نظر</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <form method="post">
                                    <input name="Id" value="@Model.Id" hidden />
                                    <input name="Url" value="@Model.Blog.Url" hidden />
                                    <div class="col-12">
                                        <label>متن نظر</label>
                                        <textarea name="Body" class="form-control" rows="8" placeholder="متن نظر خود را وارد نمایید"></textarea>
                                    </div>
                                    <div class="col-12">
                                        <button type="submit" class="btn btn-danger">ثبت نظر</button>
                                    </div>
                                </form>
                            }
                            else
                            {
                                <h6>شما اول باید وارد حساب کاربری خود شوید</h6>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
        }